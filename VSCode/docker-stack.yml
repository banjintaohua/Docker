version: "3.9"

services:
  vscode:
    image: codercom/code-server:${CODE_SERVER_VERSION:-3.9.1}
    ports:
      - "50012:8080"
    user: 0:0
    volumes:
      - vscode:/home/coder/project:rw
      - vscode:/home/coder/.local/share/code-server:rw
    networks:
      - cluster
    environment:
      PASSWORD: ${PASSWORD:ch@ngeme}
    deploy:
      replicas: 1
      restart_policy:
        condition: any
        delay: 5s
        max_attempts: 3
      placement:
        max_replicas_per_node: 1
        constraints:
          - node.hostname == VPS

volumes:
  vscode:
    driver: local
    name: vscode

networks:
  cluster:
    name: cluster
    external: true